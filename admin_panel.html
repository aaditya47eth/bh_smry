<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Collector Management</title>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/daye1yfzy/image/upload/v1765211893/ctcqhyxglwe4j13sorwu.png">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/admin_panel.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <img src="https://res.cloudinary.com/daye1yfzy/image/upload/v1761855859/5f5d5485-2656-4523-916b-5464cb0f7304.png" alt="Logo" class="header-logo" onclick="window.location.href='dashboard.html'">
            </div>
            <div class="header-actions">
                <button class="header-btn" id="adminPanelHeaderBtn" onclick="window.location.href='admin_panel.html'" style="display:none;">Admin Panel</button>
                <span class="user-name" id="userName"></span>
                <button onclick="logout()" class="header-btn" id="logoutBtn">Logout</button>
                <button onclick="window.location.href='index.html'" class="header-btn" id="loginBtn" style="display:none;">Login</button>
            </div>
        </div>
    </div>

    <div class="breadcrumb-container">
        <div class="breadcrumb-content">
            <nav class="breadcrumb">
                <a href="dashboard.html">Home</a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">Admin Panel</span>
            </nav>
        </div>
    </div>
    
    <div class="admin-layout">
        <!-- Left Sidebar Menu -->
        <aside class="sidebar">
            <div class="sidebar-menu">
                <div class="menu-item active" onclick="switchSection('users')">
                    <span class="menu-icon">‚óè</span>
                    <span class="menu-text">Collector Management</span>
                </div>
                <div class="menu-item" onclick="switchSection('stats')">
                    <span class="menu-icon">‚óè</span>
                    <span class="menu-text">Statistics</span>
                </div>
                <div class="menu-item" onclick="switchSection('checklist')">
                    <span class="menu-icon">‚óè</span>
                    <span class="menu-text">Checklist</span>
                </div>
                <div class="menu-item" onclick="switchSection('reviews')">
                    <span class="menu-icon">‚óè</span>
                    <span class="menu-text">Reviews</span>
                </div>
                <div class="menu-item" onclick="switchSection('payments')">
                    <span class="menu-icon">‚óè</span>
                    <span class="menu-text">Payment Management</span>
                </div>
                <div class="menu-item" onclick="switchSection('bidding')">
                    <span class="menu-icon">‚óè</span>
                    <span class="menu-text">Live Bidding</span>
                </div>
        </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Collector Management Section -->
            <section id="usersSection" class="content-section active">
                <div class="section-header">
                    <h1>Collector Management</h1>
        </div>

        <div class="users-container">
                    <div class="search-and-add">
                        <input type="text" id="searchInput" placeholder="Search by collector or number..." onkeyup="searchUsers()">
                        <button onclick="openAddUserModal()" class="btn btn-primary">+ Add New Collector</button>
            </div>
            <table class="users-table">
                <thead>
                    <tr>
                                <th>Collector</th>
                        <th>Number</th>
                        <th>Access Level</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <!-- Users will be loaded here -->
                </tbody>
            </table>
        </div>
            </section>

            <!-- Stats Section -->
            <section id="statsSection" class="content-section">
                <div class="section-header">
                    <h1>Statistics</h1>
                </div>

                <div class="tabs-container">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchTab('lot')">Lot-wise Stats</button>
                        <button class="tab-btn" onclick="switchTab('person')">Person-wise Stats</button>
                    </div>

                    <!-- Lot-wise Stats Tab -->
                    <div id="lotTab" class="tab-content active">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Total Lots</div>
                                    <div class="stat-value" id="totalLots">0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Total Participants</div>
                                    <div class="stat-value" id="totalParticipants">0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Paid Amount</div>
                                    <div class="stat-value" id="totalRevenue">‚Çπ0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Pending Amount</div>
                                    <div class="stat-value" id="pendingAmount">‚Çπ0</div>
                                </div>
                            </div>
                        </div>

                        <div class="table-container">
                            <h3>Lot Details</h3>
                            <table class="stats-table sortable-table">
                                <thead>
                                    <tr>
                                        <th class="sortable" onclick="sortLotTable('name')">
                                            Lot Name <span class="sort-indicator" id="sort-lot-name">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortLotTable('participants')">
                                            Participants <span class="sort-indicator" id="sort-lot-participants">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortLotTable('items')">
                                            Total Items <span class="sort-indicator" id="sort-lot-items">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortLotTable('delivered')">
                                            Delivered <span class="sort-indicator" id="sort-lot-delivered">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortLotTable('paid')">
                                            Paid <span class="sort-indicator" id="sort-lot-paid">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortLotTable('revenue')">
                                            Revenue <span class="sort-indicator" id="sort-lot-revenue">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortLotTable('pending')">
                                            Pending <span class="sort-indicator" id="sort-lot-pending">‚Üï</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="lotStatsTableBody">
                                    <!-- Lot stats will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Person-wise Stats Tab -->
                    <div id="personTab" class="tab-content">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Total Collectors</div>
                                    <div class="stat-value" id="totalUsers">0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Total Paid</div>
                                    <div class="stat-value" id="totalPaid">‚Çπ0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Total Pending</div>
                                    <div class="stat-value" id="totalPending">‚Çπ0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Total Figs</div>
                                    <div class="stat-value" id="totalFigs">0</div>
                                </div>
                            </div>
                        </div>

                        <div class="table-container">
                            <h3>Collector Details</h3>
                            <table class="stats-table sortable-table">
                                <thead>
                                    <tr>
                                        <th class="sortable" onclick="sortPersonTable('username')">
                                            Collector <span class="sort-indicator" id="sort-username">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortPersonTable('lots')">
                                            Lots Participated <span class="sort-indicator" id="sort-lots">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortPersonTable('paid')">
                                            Amount Paid <span class="sort-indicator" id="sort-paid">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortPersonTable('pending')">
                                            Amount Pending <span class="sort-indicator" id="sort-pending">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortPersonTable('figs')">
                                            Figs Collected <span class="sort-indicator" id="sort-figs">‚Üï</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="personStatsTableBody">
                                    <!-- Person stats will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Checklist Section -->
            <section id="checklistSection" class="content-section">
                <div class="section-header">
                    <h1>Checklist</h1>
                </div>

                <div class="users-container">
                    <div id="checklistTableBody">
                        <!-- Checklist sections will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Reviews Section -->
            <section id="reviewsSection" class="content-section">
                <div class="section-header">
                    <h1>Reviews</h1>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <label style="font-size: 0.875rem; font-weight: 500; color: var(--text-secondary);">Sort by:</label>
                        <select id="reviewsSortSelect" onchange="sortReviews()" style="padding: 8px 12px; border: 1px solid var(--light-gray); border-radius: 6px; font-size: 0.875rem; cursor: pointer;">
                            <option value="date-desc">Date (Newest First)</option>
                            <option value="date-asc">Date (Oldest First)</option>
                            <option value="username-asc">User (A-Z)</option>
                            <option value="username-desc">User (Z-A)</option>
                        </select>
                        <button class="btn btn-primary" onclick="openAdminAddReviewModal()">+ Add Review</button>
                    </div>
                </div>

                <div class="users-container">
                    <div id="reviewsTableBody" class="reviews-approval-grid">
                        <!-- Reviews will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Payment Management Section -->
            <section id="paymentsSection" class="content-section">
                <div class="section-header">
                    <h1>Payment Management</h1>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-primary" onclick="openAddPaymentModal()">+ Add Payment</button>
                        <button class="btn btn-secondary" onclick="deleteAllPaymentHistory()" style="background: #ef4444; color: white; border-color: #ef4444;">Clear All History</button>
                    </div>
                </div>

                <div class="users-container">
                    <div class="search-and-add" style="margin-bottom: 20px;">
                        <input type="text" id="paymentSearchInput" placeholder="Search by collector or lot..." onkeyup="searchPayments()">
                    </div>
                    <div id="paymentsTableBody">
                        <!-- Payments will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Live Bidding Section -->
            <section id="biddingSection" class="content-section">
                <div class="section-header">
                    <h1>Live Bidding</h1>
                </div>

                <div class="bidding-layout">
                    <!-- Left Sidebar -->
                    <div class="bidding-sidebar">
                        <!-- Activity Feed (Top) -->
                        <div class="bidding-control-panel">
                            <div class="bidding-panel-header">
                                <h3>üîî Activity</h3>
                            </div>
                            <div class="activity-panel" id="biddingActivityFeed">
                                <div style="color:var(--text-muted); font-style:italic;">No activity yet...</div>
                            </div>
                        </div>

                        <!-- Add Auctions -->
                        <div class="bidding-control-panel">
                            <div class="bidding-panel-header">
                                <h3>‚ûï Add Auctions</h3>
                            </div>
                            <label for="biddingPostUrls" style="display: block; margin-top: 10px; font-weight: bold; font-size: 0.9em;">Facebook Post URLs:</label>
                            <textarea id="biddingPostUrls" placeholder="Paste Facebook Post URLs (one per line)..." style="width: 100%; height: 100px; font-family: monospace; padding: 8px; margin-top: 5px; border: 1px solid var(--border-color); border-radius: 4px; box-sizing: border-box;"></textarea>
                            <button class="btn btn-primary" onclick="startBiddingWatch()" style="margin-top: 10px; width: 100%;">+ Watch All</button>
                            <button class="btn btn-secondary" onclick="stopAllBidding()" style="margin-top: 5px; width: 100%; background: #dc3545; color: white; border-color: #dc3545;">Stop All</button>
                            <p id="biddingMsg" style="color: var(--text-secondary); margin-top: 10px; font-size: 0.8em;"></p>
                        </div>

                        <!-- Cookie Management -->
                        <div class="bidding-control-panel">
                            <div class="bidding-panel-header">
                                <h3>üç™ Facebook Cookies</h3>
                            </div>
                            <div id="biddingCookieStatus" style="font-size: 0.85em; margin-bottom: 10px;">
                                <span id="cookieStatusText">Checking...</span>
                            </div>
                            <div id="biddingCookieInput" style="display: none;">
                                <textarea id="cookieInput" placeholder='Paste cookies.json content here (array format)...' style="width: 100%; height: 80px; font-family: monospace; font-size: 0.75em; padding: 8px; margin-top: 5px; border: 1px solid var(--border-color); border-radius: 4px; box-sizing: border-box;"></textarea>
                                <button class="btn btn-secondary" onclick="validateBiddingCookies()" style="margin-top: 5px; padding: 6px 12px; font-size: 0.85em; width: auto;">Validate JSON</button>
                                <button class="btn btn-primary" onclick="saveBiddingCookies()" style="margin-top: 5px; padding: 6px 12px; font-size: 0.85em; width: auto; background: #42b72a;">Save Cookies</button>
                                <p id="cookieValidationMsg" style="color: var(--text-secondary); margin-top: 8px; font-size: 0.75em;"></p>
                            </div>
                            <button class="btn btn-secondary" onclick="toggleBiddingCookieInput()" style="margin-top: 5px; padding: 6px 12px; font-size: 0.85em; width: 100%;">Update Cookies</button>
                        </div>
                    </div>

                    <!-- Main Dashboard -->
                    <div class="bidding-main-content">
                        <div id="biddingDashboard">
                            <div class="bidding-empty-state" id="biddingEmptyState">
                                <p>No auctions being watched. Add Facebook post URLs to start tracking bids.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Image Modal -->
                <div id="biddingImgModal" class="bidding-img-modal" onclick="closeBiddingImageModal()">
                    <img id="biddingModalImg" src="" onclick="event.stopPropagation()">
                </div>
            </section>
        </main>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Collector</h2>
                <button class="close" onclick="closeAddUserModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label for="newUsername">Collector Name:</label>
                        <input type="text" id="newUsername" required placeholder="Enter collector name">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">Password (optional):</label>
                        <div class="password-input-group">
                            <input type="password" id="newPassword" placeholder="Enter password (optional)">
                            <button type="button" class="toggle-password" onclick="togglePassword('newPassword')">
                                <span id="newPasswordToggle">Show</span>
                            </button>
                        </div>
                        <small style="color: var(--text-secondary); font-size: 0.8125rem; margin-top: 4px; display: block;">
                            Leave blank if you want to set password later
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="newName">Number:</label>
                        <input type="text" id="newName" required placeholder="Enter phone number">
                    </div>
                    <div class="form-group">
                        <label for="newAccessLevel">Access Level:</label>
                        <select id="newAccessLevel" required>
                            <option value="viewer">Viewer</option>
                            <option value="manager">Manager</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="closeAddUserModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Collector</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Collector</h2>
                <button class="close" onclick="closeEditUserModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editUserForm">
                    <input type="hidden" id="editUserId">
                    <div class="form-group">
                        <label for="editUsername">Collector Name:</label>
                        <input type="text" id="editUsername" required placeholder="Enter collector name">
                    </div>
                    <div class="form-group">
                        <label for="editPassword">Password:</label>
                        <div class="password-input-group">
                            <input type="password" id="editPassword" placeholder="Leave blank to keep current password">
                            <button type="button" class="toggle-password" onclick="togglePassword('editPassword')">
                                <span id="editPasswordToggle">Show</span>
                            </button>
                        </div>
                        <small>Leave blank if you don't want to change the password</small>
                    </div>
                    <div class="form-group">
                        <label for="editName">Number (optional):</label>
                        <input type="text" id="editName" placeholder="Enter phone number">
                    </div>
                    <div class="form-group">
                        <label for="editAccessLevel">Access Level:</label>
                        <select id="editAccessLevel" required>
                            <option value="viewer">Viewer</option>
                            <option value="manager">Manager</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="closeEditUserModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Collector</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Add Review Modal -->
    <div id="adminAddReviewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Review Image</h2>
                <button class="close" onclick="closeAdminAddReviewModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="adminAddReviewForm" onsubmit="event.preventDefault(); submitAdminAddReview();">
                    <div class="form-group">
                        <label for="reviewUsername">Collector Name:</label>
                        <input type="text" id="reviewUsername" list="collectorsList" required placeholder="Enter or select collector name" autocomplete="off">
                        <datalist id="collectorsList">
                            <!-- Collectors will be loaded here -->
                        </datalist>
                        <small style="color: var(--text-secondary); font-size: 0.8125rem; margin-top: 4px; display: block;">
                            Type to select existing collector or enter new name to create
                        </small>
                    </div>
                    <div class="form-group">
                        <label>Upload Review Image:</label>
                        <div id="adminReviewPasteArea" class="image-paste-area" tabindex="0" onclick="document.getElementById('adminReviewFileInput').click()">
                            <div class="paste-instructions">
                                üìé Click to select image from files<br>
                                <small style="font-size: 0.875rem; opacity: 0.7;">or press Ctrl+V to paste</small>
                            </div>
                        </div>
                        <input type="file" id="adminReviewFileInput" accept="image/*" style="display: none;" onchange="handleAdminReviewFileSelect(event)">
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="closeAdminAddReviewModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Upload Review</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Payment Modal -->
    <div id="addPaymentModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header" style="padding: 12px 20px;">
                <h2 style="font-size: 1.3rem; margin: 0;">Add Payment</h2>
                <button class="close" onclick="closeAddPaymentModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 16px 20px;">
                <form id="addPaymentForm" onsubmit="event.preventDefault(); submitPayment();">
                    <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label for="paymentUsername" style="font-size: 0.9rem; margin-bottom: 4px;">Collector Name:</label>
                            <input type="text" id="paymentUsername" list="paymentCollectorsList" required placeholder="Enter or select" autocomplete="off" style="padding: 6px 10px; font-size: 0.9rem; width: 100%;" onkeydown="handlePaymentCollectorEnter(event)">
                            <datalist id="paymentCollectorsList">
                                <!-- Collectors will be loaded here -->
                            </datalist>
                        </div>
                        
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label style="font-size: 0.9rem; margin-bottom: 4px;">Lot Names: <span style="font-weight: normal; font-size: 0.85em;">(Select to add)</span></label>
                            <input type="text" id="paymentLotNameInput" list="paymentLotsList" placeholder="Select lot name" autocomplete="off" style="width: 100%; padding: 6px 10px; font-size: 0.9rem;" onchange="autoAddLotFromDropdown()" onkeydown="handlePaymentLotEnter(event)">
                            <datalist id="paymentLotsList">
                                <!-- Lots will be loaded here -->
                            </datalist>
                        </div>
                    </div>
                    
                    <div id="selectedLotsList" style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px;">
                        <!-- Selected lots will appear here -->
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label for="paymentAmount" style="font-size: 0.9rem; margin-bottom: 4px;">Total Amount (‚Çπ): <span style="font-weight: normal; font-size: 0.85em;">(for all lots)</span></label>
                            <input type="number" id="paymentAmount" step="0.01" min="0" required placeholder="Enter total amount" style="padding: 6px 10px; font-size: 0.9rem; width: 100%;">
                        </div>
                        
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label for="paymentDate" style="font-size: 0.9rem; margin-bottom: 4px;">Payment Date:</label>
                            <input type="date" id="paymentDate" required style="padding: 6px 10px; font-size: 0.9rem; width: 100%;">
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 12px;">
                        <label style="font-size: 0.9rem; margin-bottom: 4px;">Screenshots: <span style="font-weight: normal; font-size: 0.85em;">(Optional)</span></label>
                        <div style="display: flex; gap: 6px; margin-bottom: 6px; align-items: center;">
                            <input type="file" id="paymentImageFile" accept="image/*" multiple style="display: none;" onchange="handlePaymentImageSelect(event)">
                            <button type="button" onclick="document.getElementById('paymentImageFile').click()" class="btn btn-secondary" style="padding: 4px 10px; font-size: 0.85rem;">Choose Files</button>
                            <span style="font-size: 0.8rem; color: #666;">or paste below</span>
                        </div>
                        <div id="paymentImagesPreview" 
                             style="display: flex; flex-wrap: wrap; gap: 6px; padding: 8px; border: 2px dashed #ddd; border-radius: 4px; min-height: 50px; align-items: center; justify-content: center;">
                            <span style="color: #999; font-size: 0.8rem; pointer-events: none;">Paste images anywhere in this form (Ctrl+V)</span>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 12px;">
                        <label for="paymentNotes" style="font-size: 0.9rem; margin-bottom: 4px;">Notes (optional):</label>
                        <textarea id="paymentNotes" rows="2" placeholder="Enter any notes" style="padding: 6px 10px; font-size: 0.9rem;"></textarea>
                    </div>
                    
                    <div class="form-actions" style="margin-top: 16px; gap: 8px;">
                        <button type="button" onclick="closeAddPaymentModal()" class="btn btn-secondary" style="padding: 6px 16px; font-size: 0.9rem;">Cancel</button>
                        <button type="submit" class="btn btn-primary" style="padding: 6px 16px; font-size: 0.9rem;">Add Payment</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Payment Modal -->
    <div id="editPaymentModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header" style="padding: 12px 20px;">
                <h2 style="font-size: 1.3rem; margin: 0;">Edit Payment</h2>
                <button class="close" onclick="closeEditPaymentModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 16px 20px;">
                <form id="editPaymentForm" onsubmit="event.preventDefault(); updatePayment();">
                    <input type="hidden" id="editPaymentBatchId">
                    <input type="hidden" id="editPaymentUsername">
                    
                    <div class="form-group" style="margin-bottom: 12px;">
                        <label style="font-size: 0.9rem; margin-bottom: 4px;">Collector:</label>
                        <div id="editPaymentCollector" style="padding: 8px; background: #f9fafb; border-radius: 4px; font-size: 0.9rem; font-weight: 600;">
                            <!-- Collector name will be displayed here -->
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 12px;">
                        <label style="font-size: 0.9rem; margin-bottom: 4px;">Lot Names: <span style="font-weight: normal; font-size: 0.85em;">(Select to add/remove)</span></label>
                        <input type="text" id="editPaymentLotNameInput" list="editPaymentLotsList" placeholder="Select lot name" autocomplete="off" style="width: 100%; padding: 6px 10px; font-size: 0.9rem;" onchange="addLotToEdit()" onkeydown="handleEditLotEnter(event)">
                        <datalist id="editPaymentLotsList">
                            <!-- Lots will be loaded here -->
                        </datalist>
                        <div id="editSelectedLotsList" style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 6px;">
                            <!-- Selected lots will appear here -->
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label for="editPaymentAmount" style="font-size: 0.9rem; margin-bottom: 4px;">Total Amount (‚Çπ): <span style="font-weight: normal; font-size: 0.85em;">(for all lots)</span></label>
                            <input type="number" id="editPaymentAmount" step="0.01" min="0" required placeholder="Enter total amount" style="padding: 6px 10px; font-size: 0.9rem; width: 100%;">
                        </div>
                        
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label for="editPaymentDate" style="font-size: 0.9rem; margin-bottom: 4px;">Payment Date:</label>
                            <input type="date" id="editPaymentDate" required style="padding: 6px 10px; font-size: 0.9rem; width: 100%;">
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 12px;">
                        <label for="editPaymentNotes" style="font-size: 0.9rem; margin-bottom: 4px;">Notes (optional):</label>
                        <textarea id="editPaymentNotes" rows="2" placeholder="Enter any notes" style="padding: 6px 10px; font-size: 0.9rem;"></textarea>
                    </div>
                    
                    <div class="form-actions" style="margin-top: 16px; gap: 8px; display: flex; justify-content: space-between;">
                        <button type="button" onclick="deletePaymentBatch()" class="btn btn-secondary" style="padding: 6px 16px; font-size: 0.9rem; background: #ef4444; color: white;">Delete</button>
                        <div style="display: flex; gap: 8px;">
                            <button type="button" onclick="closeEditPaymentModal()" class="btn btn-secondary" style="padding: 6px 16px; font-size: 0.9rem;">Cancel</button>
                            <button type="submit" class="btn btn-primary" style="padding: 6px 16px; font-size: 0.9rem;">Update Payment</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="js/supabase-config.js"></script>
    <script src="js/admin_panel.js"></script>
</body>
</html>

