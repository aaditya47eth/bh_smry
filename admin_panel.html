<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Collector Management</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/admin_panel.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <img src="https://res.cloudinary.com/daye1yfzy/image/upload/v1761855859/5f5d5485-2656-4523-916b-5464cb0f7304.png" alt="Logo" class="header-logo" onclick="window.location.href='dashboard.html'">
            </div>
            <div class="header-actions">
                <button class="header-btn" id="adminPanelHeaderBtn" onclick="window.location.href='admin_panel.html'" style="display:none;">Admin Panel</button>
                <span class="user-name" id="userName"></span>
                <button onclick="logout()" class="header-btn" id="logoutBtn">Logout</button>
                <button onclick="window.location.href='index.html'" class="header-btn" id="loginBtn" style="display:none;">Login</button>
            </div>
        </div>
    </div>

    <div class="breadcrumb-container">
        <div class="breadcrumb-content">
            <nav class="breadcrumb">
                <a href="dashboard.html">Home</a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">Admin Panel</span>
            </nav>
        </div>
    </div>
    
    <div class="admin-layout">
        <!-- Left Sidebar Menu -->
        <aside class="sidebar">
            <div class="sidebar-menu">
                <div class="menu-item active" onclick="switchSection('users')">
                    <span class="menu-icon">‚óè</span>
                    <span class="menu-text">Collector Management</span>
                </div>
                <div class="menu-item" onclick="switchSection('stats')">
                    <span class="menu-icon">‚óè</span>
                    <span class="menu-text">Statistics</span>
                </div>
                <div class="menu-item" onclick="switchSection('checklist')">
                    <span class="menu-icon">‚óè</span>
                    <span class="menu-text">Checklist</span>
                </div>
                <div class="menu-item" onclick="switchSection('reviews')">
                    <span class="menu-icon">‚óè</span>
                    <span class="menu-text">Reviews</span>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Collector Management Section -->
            <section id="usersSection" class="content-section active">
                <div class="section-header">
                    <h1>Collector Management</h1>
                </div>

                <div class="users-container">
                    <div class="search-and-add">
                        <input type="text" id="searchInput" placeholder="Search by collector or number..." onkeyup="searchUsers()">
                        <button onclick="openAddUserModal()" class="btn btn-primary">+ Add New Collector</button>
                    </div>
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>Collector</th>
                                <th>Number</th>
                                <th>Access Level</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Stats Section -->
            <section id="statsSection" class="content-section">
                <div class="section-header">
                    <h1>Statistics</h1>
                </div>

                <div class="tabs-container">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchTab('lot')">Lot-wise Stats</button>
                        <button class="tab-btn" onclick="switchTab('person')">Person-wise Stats</button>
                    </div>

                    <!-- Lot-wise Stats Tab -->
                    <div id="lotTab" class="tab-content active">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Total Lots</div>
                                    <div class="stat-value" id="totalLots">0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Total Participants</div>
                                    <div class="stat-value" id="totalParticipants">0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Paid Amount</div>
                                    <div class="stat-value" id="totalRevenue">‚Çπ0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Pending Amount</div>
                                    <div class="stat-value" id="pendingAmount">‚Çπ0</div>
                                </div>
                            </div>
                        </div>

                        <div class="table-container">
                            <h3>Lot Details</h3>
                            <table class="stats-table sortable-table">
                                <thead>
                                    <tr>
                                        <th class="sortable" onclick="sortLotTable('name')">
                                            Lot Name <span class="sort-indicator" id="sort-lot-name">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortLotTable('participants')">
                                            Participants <span class="sort-indicator" id="sort-lot-participants">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortLotTable('items')">
                                            Total Items <span class="sort-indicator" id="sort-lot-items">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortLotTable('delivered')">
                                            Delivered <span class="sort-indicator" id="sort-lot-delivered">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortLotTable('paid')">
                                            Paid <span class="sort-indicator" id="sort-lot-paid">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortLotTable('revenue')">
                                            Revenue <span class="sort-indicator" id="sort-lot-revenue">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortLotTable('pending')">
                                            Pending <span class="sort-indicator" id="sort-lot-pending">‚Üï</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="lotStatsTableBody">
                                    <!-- Lot stats will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Person-wise Stats Tab -->
                    <div id="personTab" class="tab-content">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Total Collectors</div>
                                    <div class="stat-value" id="totalUsers">0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Total Paid</div>
                                    <div class="stat-value" id="totalPaid">‚Çπ0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Total Pending</div>
                                    <div class="stat-value" id="totalPending">‚Çπ0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <div class="stat-label">Total Figs</div>
                                    <div class="stat-value" id="totalFigs">0</div>
                                </div>
                            </div>
                        </div>

                        <div class="table-container">
                            <h3>Collector Details</h3>
                            <table class="stats-table sortable-table">
                                <thead>
                                    <tr>
                                        <th class="sortable" onclick="sortPersonTable('username')">
                                            Collector <span class="sort-indicator" id="sort-username">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortPersonTable('lots')">
                                            Lots Participated <span class="sort-indicator" id="sort-lots">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortPersonTable('paid')">
                                            Amount Paid <span class="sort-indicator" id="sort-paid">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortPersonTable('pending')">
                                            Amount Pending <span class="sort-indicator" id="sort-pending">‚Üï</span>
                                        </th>
                                        <th class="sortable" onclick="sortPersonTable('figs')">
                                            Figs Collected <span class="sort-indicator" id="sort-figs">‚Üï</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="personStatsTableBody">
                                    <!-- Person stats will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Checklist Section -->
            <section id="checklistSection" class="content-section">
                <div class="section-header">
                    <h1>Checklist</h1>
                </div>

                <div class="users-container">
                    <div id="checklistTableBody">
                        <!-- Checklist sections will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Reviews Section -->
            <section id="reviewsSection" class="content-section">
                <div class="section-header">
                    <h1>Reviews</h1>
                    <button class="btn btn-primary" onclick="openAdminAddReviewModal()">+ Add Review</button>
                </div>

                <div class="users-container">
                    <div id="reviewsTableBody" class="reviews-approval-grid">
                        <!-- Reviews will be loaded here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Collector</h2>
                <button class="close" onclick="closeAddUserModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label for="newUsername">Collector Name:</label>
                        <input type="text" id="newUsername" required placeholder="Enter collector name">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">Password (optional):</label>
                        <div class="password-input-group">
                            <input type="password" id="newPassword" placeholder="Enter password (optional)">
                            <button type="button" class="toggle-password" onclick="togglePassword('newPassword')">
                                <span id="newPasswordToggle">Show</span>
                            </button>
                        </div>
                        <small style="color: var(--text-secondary); font-size: 0.8125rem; margin-top: 4px; display: block;">
                            Leave blank if you want to set password later
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="newName">Number:</label>
                        <input type="text" id="newName" required placeholder="Enter phone number">
                    </div>
                    <div class="form-group">
                        <label for="newAccessLevel">Access Level:</label>
                        <select id="newAccessLevel" required>
                            <option value="viewer">Viewer</option>
                            <option value="manager">Manager</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="closeAddUserModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Collector</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Collector</h2>
                <button class="close" onclick="closeEditUserModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editUserForm">
                    <input type="hidden" id="editUserId">
                    <div class="form-group">
                        <label for="editUsername">Collector Name:</label>
                        <input type="text" id="editUsername" required placeholder="Enter collector name">
                    </div>
                    <div class="form-group">
                        <label for="editPassword">Password:</label>
                        <div class="password-input-group">
                            <input type="password" id="editPassword" placeholder="Leave blank to keep current password">
                            <button type="button" class="toggle-password" onclick="togglePassword('editPassword')">
                                <span id="editPasswordToggle">Show</span>
                            </button>
                        </div>
                        <small>Leave blank if you don't want to change the password</small>
                    </div>
                    <div class="form-group">
                        <label for="editName">Number (optional):</label>
                        <input type="text" id="editName" placeholder="Enter phone number">
                    </div>
                    <div class="form-group">
                        <label for="editAccessLevel">Access Level:</label>
                        <select id="editAccessLevel" required>
                            <option value="viewer">Viewer</option>
                            <option value="manager">Manager</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="closeEditUserModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Collector</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Add Review Modal -->
    <div id="adminAddReviewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Review Image</h2>
                <button class="close" onclick="closeAdminAddReviewModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="adminAddReviewForm" onsubmit="event.preventDefault(); submitAdminAddReview();">
                    <div class="form-group">
                        <label for="reviewUsername">Collector Name:</label>
                        <input type="text" id="reviewUsername" list="collectorsList" required placeholder="Enter or select collector name" autocomplete="off">
                        <datalist id="collectorsList">
                            <!-- Collectors will be loaded here -->
                        </datalist>
                        <small style="color: var(--text-secondary); font-size: 0.8125rem; margin-top: 4px; display: block;">
                            Type to select existing collector or enter new name to create
                        </small>
                    </div>
                    <div class="form-group">
                        <label>Upload Review Image:</label>
                        <div id="adminReviewPasteArea" class="image-paste-area" tabindex="0" onclick="document.getElementById('adminReviewFileInput').click()">
                            <div class="paste-instructions">
                                üìé Click to select image from files<br>
                                <small style="font-size: 0.875rem; opacity: 0.7;">or press Ctrl+V to paste</small>
                            </div>
                        </div>
                        <input type="file" id="adminReviewFileInput" accept="image/*" style="display: none;" onchange="handleAdminReviewFileSelect(event)">
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="closeAdminAddReviewModal()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Upload Review</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="js/supabase-config.js"></script>
    <script src="js/admin_panel.js"></script>
</body>
</html>

