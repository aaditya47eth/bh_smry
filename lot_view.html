<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lot View - Collection Manager</title>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/daye1yfzy/image/upload/v1765211893/ctcqhyxglwe4j13sorwu.png">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/lot_view.css">
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <img src="https://res.cloudinary.com/daye1yfzy/image/upload/v1761855859/5f5d5485-2656-4523-916b-5464cb0f7304.png" alt="Logo" class="header-logo" onclick="window.location.href='dashboard.html'">
            </div>
            <div class="header-actions">
                <button class="header-btn" id="adminPanelHeaderBtn" onclick="window.location.href='admin_panel.html'" style="display:none;">Admin Panel</button>
                <span class="user-name" id="userName"></span>
                <button onclick="logout()" class="header-btn" id="logoutBtn">Logout</button>
                <button onclick="window.location.href='index.html'" class="header-btn" id="loginBtn" style="display:none;">Login</button>
            </div>
        </div>
    </div>

    <div class="breadcrumb-container">
        <div class="breadcrumb-content">
            <nav class="breadcrumb">
                <a href="dashboard.html">Home</a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current" id="lotTitle">Lot View</span>
            </nav>
        </div>
    </div>

    <div class="container">
        <div class="controls">
            <select id="lotDropdown" onchange="switchLot()">
                <option value="">Loading...</option>
            </select>
            
            <button class="lock-btn" id="lockBtn" onclick="toggleLock()" style="display:none;" title="Lock/Unlock Lot">
                <img id="lockIcon" src="https://res.cloudinary.com/daye1yfzy/image/upload/v1762317008/lock-open-solid-full_bh6f8q.svg" alt="Lock" class="lock-icon-img">
            </button>
            
            <span id="lotTotalDisplay" style="margin-left: 15px; font-weight: bold; font-size: 1.1em; color: #2c3e50;">Total: 0</span>
            
            <label style="margin-left: 20px;">Zoom:</label>
            <button onclick="decreaseSize()" class="zoom-btn">-</button>
            <input type="range" id="zoomSlider" min="50" max="150" step="10" value="100" oninput="setZoomLevel(this.value)">
            <span id="zoomLevel">100%</span>
            <button onclick="increaseSize()" class="zoom-btn">+</button>
            
            <label style="margin-left: 20px;">
                <input type="checkbox" id="showTotalsCheckbox" checked onclick="toggleShowTotals()">
                Show Totals
            </label>
            
            <label style="margin-left: 20px;">Quality:</label>
            <select id="pngQuality" style="margin-left: 5px; padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                <option value="1">1x</option>
                <option value="2" selected>2x</option>
                <option value="3">3x</option>
                <option value="4">4x</option>
            </select>
            <button class="generate-btn" onclick="generatePNG()">Generate PNG</button>
            <button class="add-new-btn" id="addNewBtn" onclick="openAddModal()" style="display:none;">+ Add New</button>
            <button class="smart-paste-btn" id="smartPasteBtn" onclick="openSmartPasteModal()" style="display:none;">ðŸ“‹ Smart Paste</button>
        </div>

        <div id="gallery" class="loading">
            Loading lot items...
        </div>
    </div>

    <!-- Add New Item Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add New Item to Lot</div>
            
            <form id="addItemForm" onsubmit="event.preventDefault(); addNewItem();">
                <div id="smartPasteInstructions" class="smart-paste-instructions" style="display:none;">
                    <p><strong>Smart Paste Mode:</strong> Automatically reading from clipboard...</p>
                    <ol>
                        <li id="pasteStep1" class="paste-step">1. Phone number</li>
                        <li id="pasteStep2" class="paste-step">2. Price</li>
                        <li id="pasteStep3" class="paste-step">3. Image</li>
                    </ol>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                        <strong>How it works:</strong> Smart Paste reads your current clipboard and automatically extracts phone number, price, and image.<br>
                        <small><strong>Note:</strong> Clipboard API requires HTTPS or localhost. If automatic reading doesn't work, you can paste manually (Ctrl+V) in the fields below.</small>
                    </p>
                </div>
                <div class="form-group">
                    <label>Collector:</label>
                    <input type="text" id="newUsername" list="usernames" placeholder="Enter or select collector" required onkeydown="handleCollectorEnter(event)">
                    <datalist id="usernames"></datalist>
                </div>
                
                <div class="form-group">
                    <label>Price:</label>
                    <input type="number" id="newPrice" placeholder="Enter price" class="no-spinner" required>
                </div>
                
                <div class="form-group">
                    <label>Image (Click and Paste from Clipboard - Ctrl+V):</label>
                    <div id="pasteArea" class="image-paste-area" tabindex="0">
                        <div class="paste-instructions">
                            Click here and press Ctrl+V to paste image
                        </div>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" class="btn-cancel" onclick="closeAddModal()">Cancel</button>
                    <button type="submit" class="btn-add">Add Item</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Pass Item Modal -->
    <div id="passModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Pass Item to Collector</div>
            
            <div class="form-group">
                <label>Collector:</label>
                <input type="text" id="passUsername" list="passUsernames" placeholder="Enter or select collector" required>
                <datalist id="passUsernames"></datalist>
                <small style="color: #666; display: block; margin-top: 5px;">
                    Note: If you enter a new collector, a new collector will be created.
                </small>
            </div>
            
            <div class="modal-buttons">
                <button type="button" class="btn-cancel" onclick="closePassModal()">Cancel</button>
                <button type="button" class="btn-add" onclick="passItem()">Pass Item</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/lot_view.js"></script>
</body>
</html>

